Объекты веб-хранилища `localStorage` и `sessionStorage` позволяют хранить пары ключ/значение в браузере.

Но ведь у нас уже есть куки. Зачем тогда эти объекты?

- В отличие от куки, объекты веб-хранилища не отправляются на сервер при каждом запросе. Именно поэтому мы можем хранить гораздо больше данных. Большинство современных браузеров могут выделить как минимум 5 мегабайтов данных (или больше), и этот размер можно поменять в настройках.
- Ещё одно отличие от куки – сервер не может манипулировать объектами хранилища через HTTP-заголовки. Всё делается при помощи JavaScript.
- Хранилище привязано к источнику (домен/протокол/порт). Это значит, что разные протоколы или поддомены определяют разные объекты хранилища, и они не могут получить доступ к данным друг друга.
## Ограничения
Есть несколько ограничений:
- `key` и `value` должны быть строками.
- Лимит 5 Мб+, зависит от браузера.
- Данные не имеют «времени истечения».
- Данные привязаны к источнику (домен/протокол/порт).

|`localStorage`|`sessionStorage`|
|---|---|
|Совместно используется между всеми вкладками и окнами с одинаковым источником|Разделяется в рамках вкладки браузера, среди ифреймов из того же источника|
|«Переживает» перезапуск браузера|«Переживает» перезагрузку страницы (но не закрытие вкладки)|
## API
- `setItem(key, value)` – сохранить пару ключ/значение.
- `getItem(key)` – получить данные по ключу `key`.
- `removeItem(key)` – удалить значение по ключу `key`.
- `clear()` – удалить всё.
- `key(index)` – получить ключ на заданной позиции.
- `length` – количество элементов в хранилище.
- Используйте `Object.keys` для получения всех ключей.
- Можно обращаться к ключам как к обычным свойствам объекта, в этом случае событие`storage` не срабатывает.
## Событие storage
Когда обновляются данные в `localStorage` или `sessionStorage`, генерируется событие storage со следующими свойствами:
- `key` – ключ, который обновился (`null`, если вызван `.clear()`).
- `oldValue` – старое значение (`null`, если ключ добавлен впервые).
- `newValue` – новое значение (`null`, если ключ был удалён).
- `url` – url документа, где произошло обновление.
- `storageArea` – объект `localStorage` или `sessionStorage`, где произошло обновление.

Важно: событие срабатывает на всех остальных объектах `window`, где доступно хранилище, кроме того окна, которое его вызвало.

Давайте уточним.

Представьте, что у вас есть два окна с одним и тем же сайтом. Хранилище `localStorage` разделяется между ними.

Вы можете открыть эту страницу в двух окнах браузера, чтобы проверить приведённый ниже код.

Теперь, если оба окна слушают `window.onstorage`, то каждое из них будет реагировать на обновления, произошедшие в другом окне.
```JS
// срабатывает при обновлениях, сделанных в том же хранилище из других документов

window.onstorage = event => { // можно также использовать window.addEventListener('storage', event => {
  if (event.key != 'now') return;
  alert(event.key + ':' + event.newValue + " at " + event.url);
};

localStorage.setItem('now', Date.now());
```

Обратите внимание, что событие также содержит: `event.url` – url-адрес документа, в котором данные обновились.

Также `event.storageArea` содержит объект хранилища – событие одно и то же для `sessionStorage` и `localStorage`, поэтому `event.storageArea` ссылается на то хранилище, которое было изменено. Мы можем захотеть что-то записать в ответ на изменения.

**Это позволяет разным окнам одного источника обмениваться сообщениями.**